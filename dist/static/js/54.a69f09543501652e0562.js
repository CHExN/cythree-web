webpackJsonp([54],{"9ZRE":function(e,t){},BAwE:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Gu7T"),i=s.n(a),r=s("fZjL"),n=s.n(r),l=s("Dd8w"),o=s.n(l),c=s("dC1H"),u=s("et8n"),d=s("SJI6"),f=c.a.Item,p={components:{AStepItemGroup:u.a.Group,AStepItem:u.a,DetailListItem:f,DetailList:c.a},name:"SealInfo",props:{sealInfoVisiable:{require:!0,default:!1},sealInfoData:{require:!0}},data:function(){return{fileList:[],reviewList:[]}},computed:o()({},Object(d.mapState)({user:function(e){return e.account.user}}),{current:function(){return-1===this.sealInfoData.process?this.sealInfoData.step:this.sealInfoData.step+this.sealInfoData.process},status:function(){return 1===this.sealInfoData.process?"finish":-1===this.sealInfoData.process?"error":"process"}}),methods:{handleCancleClick:function(){this.$emit("close")},processEnglishToChinese:function(e){switch(e){case 0:return"副职";case 1:return"正职";default:return e}},handleRemove:function(e){var t=this;if("removed"===e.status){t.$delete("seal/deleteFile/"+e.uid).then(function(){t.$message.success(e.name.slice(e.name.indexOf("_")+1)+" 删除成功")});var s=t.fileList.indexOf(e),a=t.fileList.slice();a.splice(s,1),t.fileList=a}},handleBeforeUpload:function(e){var t=e.size/1024/1024<20;return t||this.$message.error("File must smaller than 20Mb!"),t},customRequest:function(e){var t=this,s=e.data,a=e.file,r=(e.filename,e.onError),l=e.onProgress,o=e.onSuccess,c=new FormData;return s&&n()(s).map(function(e){c.append(e,s[e])}),c.append("file",a),c.append("id",this.sealInfoData.sealId),this.$upload("seal/uploadSealFile",c,{onUploadProgress:function(e){var t=e.total,s=e.loaded;l({percent:Math.round(s/t*100).toFixed(2)},a)}}).then(function(e){t.$message.success(a.name+" 上传成功"),t.fileList=[].concat(i()(t.fileList),[e.data.data]),o(e.data.data,a)}).catch(r),{abort:function(){this.$message.warning("upload progress is aborted.")}}},bell:function(e){var t=this,s=this.user.username+" 催了您一下印章使用人为 "+this.sealInfoData.sealUser+" 的流程进度";this.$post("message",{message:s,sender:this.user.username,senderDept:this.user.deptName,addressee:e}).then(function(s){t.$message.success("已向 "+e+" 通知")})}},watch:{sealInfoVisiable:function(){var e=this;this.sealInfoVisiable&&(this.reviewList=this.sealInfoData.review.split(","),this.$get("seal/sealFiles",{sealId:this.sealInfoData.sealId}).then(function(t){e.fileList=t.data.data}))}}},m={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a-modal",{attrs:{title:"印章信息",centered:!0,width:1e3,visible:e.sealInfoVisiable,keyboard:!1,footer:null},on:{cancel:e.handleCancleClick}},[s("a-card",{attrs:{bordered:!1}},[s("a-steps",{attrs:{progressDot:"",current:e.current,status:e.status}},[s("a-step",{attrs:{title:"创建"}},[s("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[s("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:e.sealInfoData.createDate}})],1)],1),e._v(" "),e._l(e.reviewList,function(t,a){return[s("a-step",{key:a,attrs:{title:e.processEnglishToChinese(a)}},[s("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[e.current===a+1&&0===e.sealInfoData.process&&t!==e.user.username?s("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(s){return e.bell(t)}}}):e.current>a+1||1===e.sealInfoData.process?s("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核通过",icon:"check-circle"}}):e.current===a+1&&-1===e.sealInfoData.process?s("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核未通过",icon:"exclamation-circle"}}):e._e()],1)],1)]}),e._v(" "),s("a-step",{attrs:{title:"完成"}})],2),e._v(" "),s("a-divider",{staticStyle:{"margin-bottom":"32px"}})],1),e._v(" "),s("a-card",{attrs:{bordered:!1}},[s("detail-list",{attrs:{title:"基本信息"}},[s("detail-list-item",{attrs:{term:"部门"}},[e._v(e._s(e.sealInfoData.deptName))]),e._v(" "),s("detail-list-item",{attrs:{term:"使用人"}},[e._v(e._s(e.sealInfoData.sealUser))]),e._v(" "),s("detail-list-item",{attrs:{term:"使用事由"}},[e._v(e._s(e.sealInfoData.remark))]),e._v(" "),s("detail-list-item",{attrs:{term:"份数"}},[e._v(e._s(e.sealInfoData.amount))])],1),e._v(" "),s("div",{staticStyle:{"margin-top":"32px"}},[s("a-upload-dragger",{attrs:{fileList:e.fileList,remove:e.handleRemove,customRequest:e.customRequest,beforeUpload:e.handleBeforeUpload,disabled:e.fileList.length>5}},[s("p",{staticClass:"ant-upload-drag-icon"},[s("a-icon",{attrs:{type:"inbox"}})],1),e._v(" "),s("p",{staticClass:"ant-upload-hint"},[e._v("单击或拖动文件到此区域进行上传")])])],1)],1)],1)},staticRenderFns:[]},h=s("VU/8")(p,m,!1,function(e){s("9ZRE")},"data-v-a5e8d01c",null);t.default=h.exports}});