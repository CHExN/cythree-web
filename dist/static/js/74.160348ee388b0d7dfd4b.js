webpackJsonp([74],{"0JhU":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("Gu7T"),r=a.n(o),n=a("mvHQ"),i=a.n(n),c=a("Dd8w"),s=a.n(c),l=a("SJI6"),u={labelCol:{span:4},wrapperCol:{span:17,offset:1}},d={name:"ApplicationAdd",props:{applicationAddVisiable:{default:!1},dictData:{require:!0}},data:function(){return{loading:!1,formItemLayout:u,form:this.$form.createForm(this),dataSource:[],tableIndex:0}},computed:s()({},Object(l.mapState)({user:function(t){return t.account.user}}),{columns:function(){return[{title:"物品名称",dataIndex:"name",width:"20%",scopedSlots:{customRender:"name"}},{title:"型号",dataIndex:"type",width:"15%",scopedSlots:{customRender:"type"}},{title:"数量",dataIndex:"amount",width:"15%",scopedSlots:{customRender:"amount"}},{title:"单位",dataIndex:"unit",width:"12%",scopedSlots:{customRender:"unit"}},{title:"备注",dataIndex:"remark",width:"23%",scopedSlots:{customRender:"remark"}},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"operation"}}]}}),methods:{reset:function(){this.loading=!1,this.form.resetFields(),this.dataSource=[]},onClose:function(){this.reset(),this.$emit("close")},handleSubmit:function(){var t=this;this.form.validateFields(function(e,a){if(!e){var o=[];if(t.dataSource.forEach(function(t){!1===t.isNew&&!1===t.editable&&o.push(t)}),0!==o.length){var r=i()(o,function(t,e){return"key"===t||"editable"===t||"isNew"===t?void 0:e});t.loading=!0,t.$post("application",s()({},a,{deptId:t.user.deptId,planList:r})).then(function(e){t.reset(),t.$emit("success")}).catch(function(){t.loading=!1})}else t.$message.warning("计划单至少要有一条数据")}})},newRow:function(){this.tableIndex++,this.dataSource.push({key:this.tableIndex,name:"",type:"",unit:"",amount:1,remark:"",editable:!0,isNew:!0})},remove:function(t){var e=this.dataSource.filter(function(e){return e.key!==t});this.dataSource=e},saveRow:function(t){var e=this.dataSource.filter(function(e){return e.key===t})[0];e.editable=!1,e.isNew=!1},edit:function(t){var e=this.dataSource.filter(function(e){return e.key===t})[0];e.editable=!e.editable},cancle:function(t){this.dataSource.filter(function(e){return e.key===t})[0].editable=!1},handlePlanChange:function(t,e,a){var o=[].concat(r()(this.dataSource)),n=o.filter(function(t){return e===t.key})[0];n&&(n[a]=t,this.dataSource=o)}}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-drawer",{staticStyle:{height:"calc(100% - 55px)",overflow:"auto","padding-bottom":"53px"},attrs:{title:"新增采购申请",maskClosable:!1,width:"920",placement:"right",closable:!1,visible:t.applicationAddVisiable},on:{close:t.onClose}},[a("a-form",{attrs:{form:t.form}},[a("a-row",{staticClass:"form-row"},[a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"编号"}},"a-form-item",t.formItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["num",{rules:[{required:!0,message:"申请单编号不能为空"}]}],expression:"['num',\n              {rules: [{ required: true, message: '申请单编号不能为空'}]}\n            ]"}],attrs:{placeholder:"申请单编号",autocomplete:"off",autoFocus:""}})],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"申请部门"}},"a-form-item",t.formItemLayout,!1),[a("a-input",{attrs:{placeholder:"申请部门",autocomplete:"off",disabled:"",value:this.user.deptName}})],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"物资类别"}},"a-form-item",t.formItemLayout,!1),[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["typeApplication",{initialValue:[t.dictData.typeApplication&&"{}"!==JSON.stringify(t.dictData.typeApplication)?Object.keys(t.dictData.typeApplication)[0]:""],rules:[{required:!0,message:"请选择物资类别"}]}],expression:"['typeApplication', {\n              initialValue: [dictData.typeApplication && JSON.stringify(dictData.typeApplication)!=='{}' ? Object.keys(dictData.typeApplication)[0] : ''],\n              rules: [{ required: true, message: '请选择物资类别' }]\n            }]"}],attrs:{placeholder:"物资类别"}},t._l(Object.keys(t.dictData.typeApplication||[]),function(e){return a("a-select-option",{key:e},[t._v(t._s(t.dictData.typeApplication[e]))])}),1)],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"预计金额"}},"a-form-item",t.formItemLayout,!1),[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["money"],expression:"['money']"}],staticStyle:{width:"100%"},attrs:{min:0,precision:2,formatter:function(t){return t},autocomplete:"off",placeholder:"预计金额"}})],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"采购说明"}},"a-form-item",t.formItemLayout,!1),[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{placeholder:"采购用途、采购数量、功能要求等",autocomplete:"off"}})],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"经办人"}},"a-form-item",t.formItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["handle"],expression:"['handle']"}],attrs:{placeholder:"分管采购工作经办人",autocomplete:"off"}})],1)],1)],1)],1),t._v(" "),a("a-card",{attrs:{title:"采购计划",bordered:!1}},[a("a-table",{attrs:{columns:t.columns,dataSource:t.dataSource,pagination:!1},scopedSlots:t._u([t._l(["name","type","amount","unit","remark"],function(e,o){return{key:e,fn:function(r,n){return[n.editable?a("a-input",{key:e,staticStyle:{margin:"-5px 0"},attrs:{value:r,placeholder:t.columns[o].title},on:{change:function(a){return t.handlePlanChange(a.target.value,n.key,e)}}}):[t._v(t._s(r))]]}}}),{key:"amount",fn:function(e,o){return[o.editable||o.isNew?[a("a-input-number",{attrs:{min:.01,precision:2,formatter:function(t){return t},placeholder:"数量"},model:{value:o.amount,callback:function(e){t.$set(o,"amount",e)},expression:"record.amount"}})]:a("span",[t._v(t._s(e))])]}},{key:"operation",fn:function(e,o){return[o.editable?[o.isNew?a("span",[a("a",{on:{click:function(e){return t.saveRow(o.key)}}},[t._v("添加")]),t._v(" "),a("a-divider",{attrs:{type:"vertical"}}),t._v(" "),a("a-popconfirm",{attrs:{title:"是否要删除此行？"},on:{confirm:function(e){return t.remove(o.key)}}},[a("a",[t._v("删除")])])],1):a("span",[a("a",{on:{click:function(e){return t.saveRow(o.key)}}},[t._v("保存")]),t._v(" "),a("a-divider",{attrs:{type:"vertical"}}),t._v(" "),a("a",{on:{click:function(e){return t.cancle(o.key)}}},[t._v("取消")])],1)]:a("span",[a("a",{on:{click:function(e){return t.edit(o.key)}}},[t._v("编辑")]),t._v(" "),a("a-divider",{attrs:{type:"vertical"}}),t._v(" "),a("a-popconfirm",{attrs:{title:"是否要删除此行？"},on:{confirm:function(e){return t.remove(o.key)}}},[a("a",[t._v("删除")])])],1)]}}],null,!0)}),t._v(" "),a("a-button",{staticStyle:{width:"100%","margin-top":"16px","margin-bottom":"8px"},attrs:{type:"dashed",icon:"plus"},on:{click:t.newRow}},[t._v("新增物品")])],1),t._v(" "),a("div",{staticClass:"drawer-bootom-button"},[a("a-popconfirm",{attrs:{title:"确定放弃编辑？",okText:"确定",cancelText:"取消"},on:{confirm:t.onClose}},[a("a-button",{staticStyle:{"margin-right":".8rem"}},[t._v("取消")])],1),t._v(" "),a("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.handleSubmit}},[t._v("提交")])],1)],1)},staticRenderFns:[]},p=a("VU/8")(d,m,!1,function(t){a("ePjL")},"data-v-46a5508b",null);e.default=p.exports},ePjL:function(t,e){}});