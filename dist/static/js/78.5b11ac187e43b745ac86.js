webpackJsonp([78],{SBuq:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("Gu7T"),n=a.n(r),o=a("gRE1"),i=a.n(o),c=a("mvHQ"),u=a.n(c),d=a("Zz1P"),l=a.n(d);l.a.locale("zh-cn");var s={name:"CarRefuelEdit",props:{carRefuelEditVisiable:{default:!1}},data:function(){return{loading:!1,tableLoading:!1,form:this.$form.createForm(this),dataSource:[],dataUpdate:{},tableIndex:0}},computed:{columns:function(){return[{title:"车牌号",dataIndex:"carNum",width:"30%",scopedSlots:{customRender:"carNum"}},{title:"卡号",dataIndex:"cardNum",width:"30%",scopedSlots:{customRender:"cardNum"}},{title:"金额",dataIndex:"amount",width:"30%",scopedSlots:{customRender:"amount"}},{title:"操作",dataIndex:"action",width:"10%",scopedSlots:{customRender:"operation"}}]}},methods:{reset:function(){this.loading=!1,this.form.resetFields(),this.dataSource=[]},onClose:function(){this.reset(),this.$emit("close")},setFormValues:function(t){var e=this;this.form.getFieldDecorator("date"),this.form.setFieldsValue({date:l()(t)}),this.tableLoading=!0,this.$get("carRefuel/carRefuelDetail",{date:t}).then(function(t){e.tableLoading=!1,e.dataSource=t.data})},handleSubmit:function(){var t=this;this.form.validateFields(function(e,a){if(!e)if(0!==t.dataSource.length)if(t.dataSource.find(function(t){return!t.carNum||!t.cardNum}))t.$message.warning("车牌号与卡号不能为空");else{t.dataSource.forEach(function(t){t.date=a.date.format("YYYY-MM-DD")});var r=u()(t.dataSource,function(t,e){return null===e||"cardNum"===t||"carNum"===t?void 0:e});t.loading=!0,t.$put("carRefuel",{carRefuels:r}).then(function(e){t.reset(),t.$emit("success")}).catch(function(){t.loading=!1});var n=i()(t.dataUpdate);0!==n.length&&t.$put("car/updateBatchCar",{cars:u()(n)})}else t.$message.warning("至少要有一条数据")})},remove:function(t){delete this.dataUpdate[t];var e=this.dataSource.filter(function(e){return e.carRefuelId!==t});this.dataSource=e},handleCarRefuelChange:function(t,e,a){var r=[].concat(n()(this.dataSource)),o=r.filter(function(t){return t.carId===e})[0];o&&(o[a]=t,this.dataUpdate[o.carId]=o,this.dataSource=r)}}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-drawer",{staticStyle:{height:"calc(100% - 55px)",overflow:"auto","padding-bottom":"53px"},attrs:{title:"修改车辆加油信息",maskClosable:!1,width:"650",placement:"right",closable:!1,visible:t.carRefuelEditVisiable},on:{close:t.onClose}},[a("a-form",{attrs:{form:t.form}},[a("a-form-item",{attrs:{label:"日期",labelCol:{span:3},wrapperCol:{span:18}}},[a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["date",{rules:[{required:!0,message:"请选择录入日期"}]}],expression:"['date',{\n          rules: [{ required: true, message: '请选择录入日期'}]\n        }]"}],staticStyle:{width:"100%"},attrs:{autoFocus:"",placeholder:"录入日期",autocomplete:"off",format:"YYYY-MM-DD"}})],1)],1),t._v(" "),a("a-table",{attrs:{columns:t.columns,dataSource:t.dataSource,pagination:!1,loading:t.tableLoading,rowKey:"carRefuelId"},scopedSlots:t._u([t._l(["carNum","cardNum"],function(e,r){return{key:e,fn:function(n,o){return[a("a-input",{key:e,staticStyle:{margin:"-5px 0"},attrs:{value:n,placeholder:t.columns[r].title},on:{change:function(a){return t.handleCarRefuelChange(a.target.value,o.carId,e)}}})]}}}),{key:"amount",fn:function(e,r){return[a("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1,max:1e5,precision:2,formatter:function(t){return t},placeholder:"金额"},model:{value:r.amount,callback:function(e){t.$set(r,"amount",e)},expression:"record.amount"}})]}},{key:"operation",fn:function(e,r){return[a("a-popconfirm",{attrs:{title:"是否要删除此行？"},on:{confirm:function(e){return t.remove(r.carRefuelId)}}},[a("a",[t._v("删除")])])]}}],null,!0)}),t._v(" "),a("div",{staticClass:"drawer-bootom-button"},[a("a-popconfirm",{attrs:{title:"确定放弃编辑？",okText:"确定",cancelText:"取消"},on:{confirm:t.onClose}},[a("a-button",{staticStyle:{"margin-right":".8rem"}},[t._v("取消")])],1),t._v(" "),a("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.handleSubmit}},[t._v("提交")])],1)],1)},staticRenderFns:[]},m=a("VU/8")(s,f,!1,function(t){a("jchd")},"data-v-3d8291cf",null);e.default=m.exports},jchd:function(t,e){}});