webpackJsonp([81],{ZQKC:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("Dd8w"),a=n.n(o),s=n("mvHQ"),i=n.n(s),r=n("fZjL"),c=n.n(r),l=n("gRE1"),u=n.n(l),d=n("+6Bu"),m=n.n(d),h={name:"distWC",props:{distWcVisiable:{default:!1}},data:function(){return{advanced:!1,dataSource:[],selectedRowKeys:[],selectedRows:[],rowIdCounts:{},paginationInfo:null,queryParams:{wcOwn:[]},wcOwnData:[],pagination:{size:"small",pageSizeOptions:["20","40","80","160"],defaultCurrent:1,defaultPageSize:20,showSizeChanger:!0,showTotal:function(t){return"共 "+t+" 条"}},loading:!1,butLoading:!1,storeroom:null}},computed:{filteredWcOwnOptions:function(){var t=this;return this.wcOwnData.filter(function(e){return!t.queryParams.wcOwn.includes(e)})},columns:function(){return[{title:"公厕名称",dataIndex:"wcName",width:200,scopedSlots:{customRender:"wcName"}},{title:"公厕编号",dataIndex:"wcNum",width:150,scopedSlots:{customRender:"wcNum"}},{title:"分队",dataIndex:"wcOwn",width:150,scopedSlots:{customRender:"wcOwn"}},{title:"分配数量",dataIndex:"district",scopedSlots:{customRender:"district"}}]}},methods:{toggleAdvanced:function(){this.advanced=!this.advanced,this.advanced||(this.queryParams.wcName="")},setFormValues:function(t){var e=m()(t,[]);this.storeroom=e},handleOwnChange:function(t){this.queryParams.wcOwn=t||[]},onSelectChange:function(t){this.selectedRowKeys=t},onSelect:function(t,e){if(e){this.$set(this.rowIdCounts,t.wcId,this.storeroom.amountDist>=1?1:this.storeroom.amountDist);var n=this.storeroom.amountDist-this.rowIdCounts[t.wcId];this.storeroom.amountDist=Math.round(100*n)/100}else this.storeroom.amountDist+=this.rowIdCounts[t.wcId],delete this.rowIdCounts[t.wcId]},onSelectAll:function(t,e,n){var o=this;t?n.forEach(function(t){o.$set(o.rowIdCounts,t.wcId,o.storeroom.amountDist>=1?1:o.storeroom.amountDist);var e=o.storeroom.amountDist-o.rowIdCounts[t.wcId];o.storeroom.amountDist=Math.round(100*e)/100}):n.forEach(function(t){o.storeroom.amountDist+=o.rowIdCounts[t.wcId],delete o.rowIdCounts[t.wcId]})},onEmpty:function(){this.storeroom.amountDist=this.storeroom.storeroomCount,this.selectedRowKeys=[],this.rowIdCounts={}},onClose:function(){this.onEmpty(),this.$emit("close")},onInputNumberChange:function(t,e){var n=this.$tools.sumArr(u()(this.rowIdCounts)),o=this.storeroom.storeroomCount;if(n>o)return this.rowIdCounts[e]=o-(n-t),void(this.storeroom.amountDist=0);var a=o-n;this.storeroom.amountDist=Math.round(100*a)/100},handleSubmit:function(){var t=this,e=c()(this.rowIdCounts);if(0!==e.length){var n=[];e.forEach(function(e){var o=t.rowIdCounts[e];0!==o&&n.push({wcId:parseInt(e),storeroomId:t.storeroom.id,amount:o})}),this.butLoading=!0,this.$post("wc/addWcStoreroom",{wcStoreroomStr:i()(n),amountDist:this.storeroom.amountDist}).then(function(e){t.butLoading=!1,t.reset(),t.$emit("success")})}else this.$message.warning("格式出错，请检查表单")},search:function(){this.fetch(a()({},this.queryParams))},reset:function(){this.onEmpty(),this.advanced=!1,this.$refs.TableInfo.pagination.current=this.pagination.defaultCurrent,this.paginationInfo&&(this.paginationInfo.current=this.pagination.defaultCurrent,this.paginationInfo.pageSize=this.pagination.defaultPageSize),this.paginationInfo=null,this.queryParams={wcOwn:[]},this.fetch()},handleTableChange:function(t,e,n){this.paginationInfo=t,this.fetch(a()({},this.queryParams))},loadSelect:function(){var t=this;this.$get("wc/wcOwns",{}).then(function(e){t.wcOwnData=e.data.filter(function(t){return t})})},fetch:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0,this.paginationInfo?(this.$refs.TableInfo.pagination.current=this.paginationInfo.current,this.$refs.TableInfo.pagination.pageSize=this.paginationInfo.pageSize,e.pageSize=this.paginationInfo.pageSize,e.pageNum=this.paginationInfo.current):(e.pageSize=this.pagination.defaultPageSize,e.pageNum=this.pagination.defaultCurrent),this.$get("wc/wcName",a()({},e)).then(function(e){var n=e.data,o=a()({},t.pagination);o.total=n.total,t.loading=!1,t.dataSource=n.rows,t.pagination=o})}},watch:{distWcVisiable:function(){this.distWcVisiable&&0===this.dataSource.length&&(this.loadSelect(),this.fetch())}}},f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-drawer",{staticStyle:{height:"calc(100% - 55px)",overflow:"auto","padding-bottom":"53px"},attrs:{maskClosable:!1,width:"800",placement:"right",closable:!1,visible:t.distWcVisiable},on:{close:t.onClose}},[n("div",{class:t.advanced?"search":null},[n("a-form",{attrs:{layout:"horizontal"}},[n("a-row",[n("div",{class:t.advanced?null:"fold"},[n("a-col",{attrs:{md:12,sm:24}},[n("a-form-item",{attrs:{label:"分队名",labelCol:{span:4},wrapperCol:{span:18,offset:1}}},[n("a-select",{attrs:{mode:"multiple",allowClear:!0},on:{change:t.handleOwnChange}},t._l(t.filteredWcOwnOptions,function(e){return n("a-select-option",{key:e},[t._v(t._s(e))])}),1)],1)],1),t._v(" "),n("a-col",{attrs:{md:12,sm:24}},[n("a-form-item",{attrs:{label:"公厕编号",labelCol:{span:4},wrapperCol:{span:18,offset:1}}},[n("a-input",{model:{value:t.queryParams.wcNum,callback:function(e){t.$set(t.queryParams,"wcNum",e)},expression:"queryParams.wcNum"}})],1)],1),t._v(" "),t.advanced?[n("a-col",{attrs:{md:12,sm:24}},[n("a-form-item",{attrs:{label:"公厕名称",labelCol:{span:4},wrapperCol:{span:18,offset:1}}},[n("a-input",{model:{value:t.queryParams.wcName,callback:function(e){t.$set(t.queryParams,"wcName",e)},expression:"queryParams.wcName"}})],1)],1)]:t._e()],2),t._v(" "),n("span",{staticStyle:{float:"right",margin:"3px auto 1em"}},[n("a",{staticStyle:{"margin-left":"8px"},on:{click:t.toggleAdvanced}},[t._v("\n            "+t._s(t.advanced?"收起":"展开")+"\n            "),n("a-icon",{attrs:{type:t.advanced?"up":"down"}})],1),t._v("\n           \n          "),n("a-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("查询")]),t._v(" "),n("a-button",{staticStyle:{"margin-left":"8px"},on:{click:t.reset}},[t._v("重置")])],1)])],1)],1),t._v(" "),n("div",[n("div",{staticClass:"alert"},[n("a-alert",{attrs:{type:"info","show-icon":!0}},[n("div",{attrs:{slot:"message"},slot:"message"},[t._v("\n          已选择 \n          "),n("a",{staticStyle:{"font-weight":"600"}},[t._v(t._s(t.selectedRowKeys.length))]),t._v(" \n          项 , \n          "),t.storeroom?n("span",[n("a",[t._v(t._s(t.storeroom.name))]),t._v(" \n            剩余 \n            "),n("a",[t._v(t._s(t.storeroom.amountDist))]),t._v(" \n            "+t._s(t.storeroom.unit)+"\n          ")]):t._e(),t._v(" "),n("a",{staticStyle:{"margin-left":"24px"},on:{click:t.onEmpty}},[t._v("清空")])])])],1),t._v(" "),n("a-table",{ref:"TableInfo",attrs:{columns:t.columns,dataSource:t.dataSource,pagination:t.pagination,loading:t.loading,rowSelection:{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange,onSelect:this.onSelect,onSelectAll:this.onSelectAll},scroll:{y:715},rowKey:"wcId"},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"wcName",fn:function(e){return[n("a-popover",{attrs:{placement:"topLeft"}},[n("template",{slot:"content"},[n("div",[t._v(t._s(e))])]),t._v(" "),n("p",{staticStyle:{width:"150px","margin-bottom":"0"}},[t._v(t._s(e))])],2)]}},{key:"wcNum",fn:function(e){return[n("span",{staticStyle:{width:"100px"}},[t._v(t._s(e))])]}},{key:"wcOwn",fn:function(e){return[n("span",{staticStyle:{width:"100px"}},[t._v(t._s(e))])]}},{key:"district",fn:function(e,o){return[t.selectedRowKeys.includes(o.wcId)?[n("a-input-number",{attrs:{min:0,max:t.storeroom.amountDist+t.rowIdCounts[o.wcId],precision:2,formatter:function(t){return t},parser:function(t){return parseFloat(t)||0}},on:{change:function(e){return t.onInputNumberChange(t.rowIdCounts[o.wcId],o.wcId)}},model:{value:t.rowIdCounts[o.wcId],callback:function(e){t.$set(t.rowIdCounts,o.wcId,e)},expression:"rowIdCounts[record.wcId]"}})]:n("span")]}}])})],1),t._v(" "),n("div",{staticClass:"drawer-bootom-button"},[n("a-popconfirm",{attrs:{title:"确定放弃？",okText:"确定",cancelText:"取消"},on:{confirm:t.onClose}},[n("a-button",{staticStyle:{"margin-right":".8rem"}},[t._v("取消")])],1),t._v(" "),n("a-button",{attrs:{type:"primary",loading:t.butLoading},on:{click:t.handleSubmit}},[t._v("提交")])],1)])},staticRenderFns:[]},w=n("VU/8")(h,f,!1,function(t){n("soRh")},"data-v-303f5401",null);e.default=w.exports},soRh:function(t,e){}});