webpackJsonp([22,74,85],{"0JhU":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Gu7T"),n=a.n(i),o=a("mvHQ"),s=a.n(o),r=a("Dd8w"),l=a.n(r),c=a("SJI6"),p={labelCol:{span:4},wrapperCol:{span:17,offset:1}},d={name:"ApplicationAdd",props:{applicationAddVisiable:{default:!1},dictData:{require:!0}},data:function(){return{loading:!1,formItemLayout:p,form:this.$form.createForm(this),dataSource:[],tableIndex:0}},computed:l()({},Object(c.mapState)({user:function(t){return t.account.user}}),{columns:function(){return[{title:"物品名称",dataIndex:"name",width:"20%",scopedSlots:{customRender:"name"}},{title:"型号",dataIndex:"type",width:"15%",scopedSlots:{customRender:"type"}},{title:"数量",dataIndex:"amount",width:"15%",scopedSlots:{customRender:"amount"}},{title:"单位",dataIndex:"unit",width:"12%",scopedSlots:{customRender:"unit"}},{title:"备注",dataIndex:"remark",width:"23%",scopedSlots:{customRender:"remark"}},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"operation"}}]}}),methods:{reset:function(){this.loading=!1,this.form.resetFields(),this.dataSource=[]},onClose:function(){this.reset(),this.$emit("close")},handleSubmit:function(){var t=this;this.form.validateFields(function(e,a){if(!e){var i=[];if(t.dataSource.forEach(function(t){!1===t.isNew&&!1===t.editable&&i.push(t)}),0!==i.length){var n=s()(i,function(t,e){return"key"===t||"editable"===t||"isNew"===t?void 0:e});t.loading=!0,t.$post("application",l()({},a,{deptId:t.user.deptId,planList:n})).then(function(e){t.reset(),t.$emit("success")}).catch(function(){t.loading=!1})}else t.$message.warning("计划单至少要有一条数据")}})},newRow:function(){this.tableIndex++,this.dataSource.push({key:this.tableIndex,name:"",type:"",unit:"",amount:1,remark:"",editable:!0,isNew:!0})},remove:function(t){var e=this.dataSource.filter(function(e){return e.key!==t});this.dataSource=e},saveRow:function(t){var e=this.dataSource.filter(function(e){return e.key===t})[0];e.editable=!1,e.isNew=!1},edit:function(t){var e=this.dataSource.filter(function(e){return e.key===t})[0];e.editable=!e.editable},cancle:function(t){this.dataSource.filter(function(e){return e.key===t})[0].editable=!1},handlePlanChange:function(t,e,a){var i=[].concat(n()(this.dataSource)),o=i.filter(function(t){return e===t.key})[0];o&&(o[a]=t,this.dataSource=i)}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-drawer",{staticStyle:{height:"calc(100% - 55px)",overflow:"auto","padding-bottom":"53px"},attrs:{title:"新增采购申请",maskClosable:!1,width:"920",placement:"right",closable:!1,visible:t.applicationAddVisiable},on:{close:t.onClose}},[a("a-form",{attrs:{form:t.form}},[a("a-row",{staticClass:"form-row"},[a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"编号"}},"a-form-item",t.formItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["num",{rules:[{required:!0,message:"申请单编号不能为空"}]}],expression:"['num',\n              {rules: [{ required: true, message: '申请单编号不能为空'}]}\n            ]"}],attrs:{placeholder:"申请单编号",autocomplete:"off",autoFocus:""}})],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"申请部门"}},"a-form-item",t.formItemLayout,!1),[a("a-input",{attrs:{placeholder:"申请部门",autocomplete:"off",disabled:"",value:this.user.deptName}})],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"物资类别"}},"a-form-item",t.formItemLayout,!1),[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["typeApplication",{initialValue:[t.dictData.typeApplication&&"{}"!==JSON.stringify(t.dictData.typeApplication)?Object.keys(t.dictData.typeApplication)[0]:""],rules:[{required:!0,message:"请选择物资类别"}]}],expression:"['typeApplication', {\n              initialValue: [dictData.typeApplication && JSON.stringify(dictData.typeApplication)!=='{}' ? Object.keys(dictData.typeApplication)[0] : ''],\n              rules: [{ required: true, message: '请选择物资类别' }]\n            }]"}],attrs:{placeholder:"物资类别"}},t._l(Object.keys(t.dictData.typeApplication||[]),function(e){return a("a-select-option",{key:e},[t._v(t._s(t.dictData.typeApplication[e]))])}),1)],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"预计金额"}},"a-form-item",t.formItemLayout,!1),[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["money"],expression:"['money']"}],staticStyle:{width:"100%"},attrs:{min:0,precision:2,formatter:function(t){return t},autocomplete:"off",placeholder:"预计金额"}})],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"采购说明"}},"a-form-item",t.formItemLayout,!1),[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{placeholder:"采购用途、采购数量、功能要求等",autocomplete:"off"}})],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",t._b({attrs:{label:"经办人"}},"a-form-item",t.formItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["handle"],expression:"['handle']"}],attrs:{placeholder:"分管采购工作经办人",autocomplete:"off"}})],1)],1)],1)],1),t._v(" "),a("a-card",{attrs:{title:"采购计划",bordered:!1}},[a("a-table",{attrs:{columns:t.columns,dataSource:t.dataSource,pagination:!1},scopedSlots:t._u([t._l(["name","type","amount","unit","remark"],function(e,i){return{key:e,fn:function(n,o){return[o.editable?a("a-input",{key:e,staticStyle:{margin:"-5px 0"},attrs:{value:n,placeholder:t.columns[i].title},on:{change:function(a){return t.handlePlanChange(a.target.value,o.key,e)}}}):[t._v(t._s(n))]]}}}),{key:"amount",fn:function(e,i){return[i.editable||i.isNew?[a("a-input-number",{attrs:{min:.01,precision:2,formatter:function(t){return t},placeholder:"数量"},model:{value:i.amount,callback:function(e){t.$set(i,"amount",e)},expression:"record.amount"}})]:a("span",[t._v(t._s(e))])]}},{key:"operation",fn:function(e,i){return[i.editable?[i.isNew?a("span",[a("a",{on:{click:function(e){return t.saveRow(i.key)}}},[t._v("添加")]),t._v(" "),a("a-divider",{attrs:{type:"vertical"}}),t._v(" "),a("a-popconfirm",{attrs:{title:"是否要删除此行？"},on:{confirm:function(e){return t.remove(i.key)}}},[a("a",[t._v("删除")])])],1):a("span",[a("a",{on:{click:function(e){return t.saveRow(i.key)}}},[t._v("保存")]),t._v(" "),a("a-divider",{attrs:{type:"vertical"}}),t._v(" "),a("a",{on:{click:function(e){return t.cancle(i.key)}}},[t._v("取消")])],1)]:a("span",[a("a",{on:{click:function(e){return t.edit(i.key)}}},[t._v("编辑")]),t._v(" "),a("a-divider",{attrs:{type:"vertical"}}),t._v(" "),a("a-popconfirm",{attrs:{title:"是否要删除此行？"},on:{confirm:function(e){return t.remove(i.key)}}},[a("a",[t._v("删除")])])],1)]}}],null,!0)}),t._v(" "),a("a-button",{staticStyle:{width:"100%","margin-top":"16px","margin-bottom":"8px"},attrs:{type:"dashed",icon:"plus"},on:{click:t.newRow}},[t._v("新增物品")])],1),t._v(" "),a("div",{staticClass:"drawer-bootom-button"},[a("a-popconfirm",{attrs:{title:"确定放弃编辑？",okText:"确定",cancelText:"取消"},on:{confirm:t.onClose}},[a("a-button",{staticStyle:{"margin-right":".8rem"}},[t._v("取消")])],1),t._v(" "),a("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.handleSubmit}},[t._v("提交")])],1)],1)},staticRenderFns:[]},m=a("VU/8")(d,u,!1,function(t){a("ePjL")},"data-v-46a5508b",null);e.default=m.exports},Dwjw:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("bOdI"),n=a.n(i),o=a("fZjL"),s=a.n(o),r=a("Dd8w"),l=a.n(r),c=a("JpjP"),p=a("wFiq"),d=a("0JhU"),u=a("/XKx"),m=a("SJI6"),f=a("Mc2z"),h={name:"Application",components:{RangeDate:c.a,ApplicationInfo:p.default,ApplicationAdd:d.default,PutAdd:u.default},data:function(){return{advanced:!1,applicationInfo:{visiable:!1,data:{}},applicationAdd:{visiable:!1},putAdd:{visiable:!1},queryParams:{createTimeFrom:"",createTimeTo:""},filteredInfo:null,sortedInfo:null,paginationInfo:null,dataSource:[],selectedRowKeys:[],selectedRows:[],dictData:{},putingData:{},loading:!1,pagination:{pageSizeOptions:["10","20","30","40","100"],defaultCurrent:1,defaultPageSize:10,showQuickJumper:!0,showSizeChanger:!0,showTotal:function(t,e){return"显示 "+e[0]+" ~ "+e[1]+" 条记录，共 "+t+" 条记录"}}}},computed:l()({},Object(m.mapState)({user:function(t){return t.account.user}}),{columns:function(){var t=this,e=this.$createElement,a=this.sortedInfo,i=this.filteredInfo;return a=a||{},i=i||{},[{title:"编号",dataIndex:"num",sorter:!0,sortOrder:"num"===a.columnKey&&a.order},{title:"物资类别",dataIndex:"typeApplication",customRender:function(e,a,i){return t.dictData.typeApplication[e]}},{title:"申请部门",dataIndex:"deptName"},{title:"申请日期",dataIndex:"createDate",sorter:!0,sortOrder:"createDate"===a.columnKey&&a.order},{title:"流程状态",dataIndex:"process",customRender:function(t,a,i){switch(t){case 2:return e("a-tag",{attrs:{color:"green"}},["已入库"]);case 1:return e("a-tag",{attrs:{color:"cyan"}},["已通过"]);case 0:return e("a-tag",{attrs:{color:"purple"}},["待审核"]);case-1:return e("a-tag",{attrs:{color:"pink"}},["未通过"]);default:return t}},filters:[{text:"未通过",value:"-1"},{text:"待审核",value:"0"},{text:"已通过",value:"1"},{text:"已入库",value:"2"}],filterMultiple:!1,filteredValue:i.process||null},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},fixed:"right",width:150}]}}),mounted:function(){this.loadSelect()},methods:{onSelectChange:function(t,e){this.selectedRowKeys=t,this.selectedRows=e},toggleAdvanced:function(){this.advanced=!this.advanced,this.advanced||(this.queryParams.handle="",this.queryParams.createTimeFrom="",this.queryParams.createTimeTo="")},isPass:function(t,e){var a=this,i={id:e.id,num:e.num,createDate:e.createDate,typeApplication:e.typeApplication,process:0,username:e.username};t?e.review.split(",").length===e.step?i.process=1:i.step=e.step+1:i.process=-1,this.loading=!0,this.$put("application",l()({},i)).then(function(t){a.fetch(),a.$message.success("操作成功")})},view:function(t){var e=this;s()(this.dictData).forEach(function(a){t[a+"ToDict"]=e.dictData[a][t[a]]}),this.applicationInfo.data=t,this.applicationInfo.visiable=!0},add:function(){this.applicationAdd.visiable=!0},handleApplicationAddClose:function(){this.applicationAdd.visiable=!1},handleApplicationAddSuccess:function(){this.applicationAdd.visiable=!1,this.$message.success("新增采购申请成功"),this.search()},storage:function(t){var e=this;this.putingData=t,this.$get("application/applicationPlan",{applicationId:this.putingData.id}).then(function(a){e.$refs.putAdd.setTableValues(t.typeApplication,a.data)}),this.putAdd.visiable=!0},handlePutAddClose:function(){this.putAdd.visiable=!1},handlePutAddSuccess:function(){var t=this;this.putAdd.visiable=!1,this.$message.success("新增入库成功"),this.loading=!0,this.$put("application",{num:this.putingData.num,id:this.putingData.id,typeApplication:this.putingData.typeApplication,username:this.putingData.username,process:2}).then(function(e){t.search(),t.putingData={}})},handleApplicationInfoClose:function(){this.applicationInfo.visiable=!1},handleTypeApplicationChange:function(t){this.queryParams.typeApplication=t||""},handleDateChange:function(t){t&&(this.queryParams.createTimeFrom=t[0],this.queryParams.createTimeTo=t[1])},loadSelect:function(){var t=this;this.$get("dict/cy_application",{}).then(function(e){var a={};e.data.forEach(function(e){var i=t.$tools.toHump(e.fieldName.toLowerCase());a[i]?a[i][e.keyy]=e.valuee:a[i]=n()({},e.keyy,e.valuee)}),t.dictData=a,t.fetch()})},batchDelete:function(){if(this.selectedRowKeys.length){var t=this;this.$confirm({title:"确定删除所选中的记录?",content:"当您点击确定按钮后，这些记录将会被彻底删除",centered:!0,onOk:function(){t.$delete("application/"+t.selectedRowKeys.join(",")).then(function(){t.$message.success("删除成功"),t.selectedRowKeys=[],t.selectedRows=[],t.search()})},onCancel:function(){t.selectedRowKeys=[],t.selectedRows=[]}})}else this.$message.warning("请选择需要删除的记录")},exportApplication:function(){var t=this;if(this.selectedRowKeys.length){var e=[];this.selectedRows.forEach(function(a){var i={num:a.num,typeApplicationToDict:t.dictData.typeApplication[a.typeApplication],deptName:a.deptName,handle:a.handle,description:"采购说明 (采购用途、采购数量、功能要求等): "+(a.description||""),money:"预计金额:"+a.money+"\n",isIn:"采购计划:（ 内□ / 外□ ）"},n="采购计划：\n";t.$get("application/applicationPlan",{applicationId:a.id}).then(function(t){t.data.forEach(function(t){n=""+n+t.name+":"+t.amount+" "+t.unit+"\n"}),i.money=n+"预计金额:"+a.money+"\n",e.push(i)})}),this.$message.loading("正在生成",3,function(){e.forEach(function(t){var e=Object(f.d)("Application");e=Object(f.a)(e,"Application",t);var a="采购申请单_"+t.num+".xlsx";Object(f.e)(e,a)})})}else this.$message.warning("请选择需要导出的记录")},exportPlan:function(){var t=this;if(this.selectedRowKeys.length){var e=[],a={};this.selectedRows.forEach(function(i){e.push({num:i.num,id:i.id,typeApplicationToDict:t.dictData.typeApplication[i.typeApplication],deptName:i.deptName,purDept:i.purDept,appDept:i.appDept,handle:i.handle,date:i.createDate}),t.$get("application/applicationPlan",{applicationId:i.id}).then(function(t){var e=[];t.data.forEach(function(t,a){e.push([a+1,t.name,"","",t.type,t.unit,t.amount,t.remark])}),a[i.id]=e})}),this.$message.loading("正在生成",3,function(){e.forEach(function(t){var e=Object(f.d)("Plan");e=Object(f.a)(e,"Plan",t),e=Object(f.b)(e,"Plan",a[""+t.id]);var i="采购计划单_"+t.num+".xlsx";Object(f.e)(e,i),Object(f.c)(e,"Plan",a[""+t.id].length)})})}else this.$message.warning("请选择需要导出的记录")},search:function(){var t=this.sortedInfo,e=this.filteredInfo,a=void 0,i=void 0;t&&(a=t.field,i=t.order),this.fetch(l()({sortField:a,sortOrder:i},this.queryParams,e))},reset:function(){this.selectedRowKeys=[],this.selectedRows=[],this.$refs.TableInfo.pagination.current=this.pagination.defaultCurrent,this.paginationInfo&&(this.paginationInfo.current=this.pagination.defaultCurrent,this.paginationInfo.pageSize=this.pagination.defaultPageSize),this.filteredInfo=null,this.sortedInfo=null,this.queryParams={createTimeFrom:"",createTimeTo:""},this.putingData={},this.advanced&&this.$refs.createTime.reset(),this.fetch()},handleTableChange:function(t,e,a){this.paginationInfo=t,this.filteredInfo=e,this.sortedInfo=a,this.applicationInfo.visiable=!1,this.fetch(l()({sortField:a.field,sortOrder:a.order},this.queryParams,e))},fetch:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0,this.paginationInfo?(this.$refs.TableInfo.pagination.current=this.paginationInfo.current,this.$refs.TableInfo.pagination.pageSize=this.paginationInfo.pageSize,e.pageSize=this.paginationInfo.pageSize,e.pageNum=this.paginationInfo.current):(e.pageSize=this.pagination.defaultPageSize,e.pageNum=this.pagination.defaultCurrent),this.$get("application",l()({},e)).then(function(e){var a=e.data,i=l()({},t.pagination);i.total=a.total,t.dataSource=a.rows,t.pagination=i,t.loading=!1})}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-card",{staticClass:"card-area",attrs:{bordered:!1}},[a("div",{class:t.advanced?"search":null},[a("a-form",{attrs:{layout:"horizontal"}},[a("a-row",[a("div",{class:t.advanced?null:"fold"},[a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",{attrs:{label:"物资类别",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-select",{attrs:{mode:"multiple",allowClear:!0},on:{change:t.handleTypeApplicationChange}},t._l(Object.keys(t.dictData.typeApplication||[]),function(e){return a("a-select-option",{key:e},[t._v(t._s(t.dictData.typeApplication[e]))])}),1)],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",{attrs:{label:"编号",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-input",{model:{value:t.queryParams.num,callback:function(e){t.$set(t.queryParams,"num",e)},expression:"queryParams.num"}})],1)],1),t._v(" "),t.advanced?[a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",{attrs:{label:"申请日期",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("range-date",{ref:"createTime",on:{change:t.handleDateChange}})],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",{attrs:{label:"经办人",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-input",{model:{value:t.queryParams.handle,callback:function(e){t.$set(t.queryParams,"handle",e)},expression:"queryParams.handle"}})],1)],1)]:t._e()],2),t._v(" "),a("span",{staticStyle:{float:"right",margin:"3px auto 1em"}},[a("a-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("查询")]),t._v(" "),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:t.reset}},[t._v("重置")]),t._v(" "),a("a",{staticStyle:{"margin-left":"8px"},on:{click:t.toggleAdvanced}},[t._v("\n            "+t._s(t.advanced?"收起":"展开")+"\n            "),a("a-icon",{attrs:{type:t.advanced?"up":"down"}})],1)],1)])],1)],1),t._v(" "),a("div",[a("div",{staticClass:"operator"},[a("a-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"application:add",expression:"'application:add'"}],attrs:{type:"primary",ghost:""},on:{click:t.add}},[t._v("新增")]),t._v(" "),a("a-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"application:delete",expression:"'application:delete'"}],on:{click:t.batchDelete}},[t._v("删除")]),t._v(" "),a("a-dropdown",{directives:[{name:"hasAnyPermission",rawName:"v-hasAnyPermission",value:"application:export",expression:"'application:export'"}]},[a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",{key:"application-export-data",on:{click:t.exportApplication}},[t._v("导出申请单")]),t._v(" "),a("a-menu-item",{key:"plan-export-data",on:{click:t.exportPlan}},[t._v("导出计划单")])],1),t._v(" "),a("a-button",[t._v("\n          更多操作 "),a("a-icon",{attrs:{type:"down"}})],1)],1)],1),t._v(" "),a("a-table",{ref:"TableInfo",attrs:{columns:t.columns,dataSource:t.dataSource,pagination:t.pagination,loading:t.loading,rowSelection:{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},scroll:{x:900},rowKey:"id"},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"operation",fn:function(e,i){return[a("a-icon",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"application:view",expression:"'application:view'"}],attrs:{type:"eye",theme:"twoTone",twoToneColor:"#42b983",title:"查看"},on:{click:function(e){return t.view(i)}}}),t._v("\n         \n        "),a("a-popconfirm",{attrs:{title:"是否通过此申请 ?",okText:"通过",cancelText:"不通过"},on:{confirm:function(e){return t.isPass(1,i)},cancel:function(e){return t.isPass(0,i)}}},[0===i.process&&i.review.split(",")[i.step-1]===t.user.username?a("a-icon",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"application:update",expression:"'application:update'"}],attrs:{type:"check-circle",theme:"twoTone",twoToneColor:"#9451ff",title:"确认"}}):t._e()],1),t._v(" "),1===i.process&&("wxclkg"===t.user.username&&"4"===i.typeApplication||"lbbjkg"===t.user.username&&("1"===i.typeApplication||"2"===i.typeApplication)||"captain"===t.user.username||"vice"===t.user.username||"xzhisoft"===t.user.username)?a("a-icon",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"storeroomPut:add",expression:"'storeroomPut:add'"}],attrs:{type:"database",theme:"twoTone",twoToneColor:"#01c9c4",title:"入库"},on:{click:function(e){return t.storage(i)}}}):t._e()]}}])})],1),t._v(" "),a("application-info",{attrs:{applicationInfoData:t.applicationInfo.data,applicationInfoVisiable:t.applicationInfo.visiable},on:{close:t.handleApplicationInfoClose}}),t._v(" "),a("application-add",{attrs:{dictData:t.dictData,applicationAddVisiable:t.applicationAdd.visiable},on:{close:t.handleApplicationAddClose,success:t.handleApplicationAddSuccess}}),t._v(" "),a("put-add",{ref:"putAdd",attrs:{putAddVisiable:t.putAdd.visiable},on:{close:t.handlePutAddClose,success:t.handlePutAddSuccess}})],1)},staticRenderFns:[]},g=a("VU/8")(h,v,!1,function(t){a("wTVK")},"data-v-36e6227f",null);e.default=g.exports},ePjL:function(t,e){},kWdU:function(t,e){},wFiq:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Gu7T"),n=a.n(i),o=a("fZjL"),s=a.n(o),r=a("Dd8w"),l=a.n(r),c=a("dC1H"),p=a("et8n"),d=a("SJI6"),u=c.a.Item,m={components:{AStepItemGroup:p.a.Group,AStepItem:p.a,DetailListItem:u,DetailList:c.a},name:"ApplicationInfo",props:{applicationInfoVisiable:{require:!0,default:!1},applicationInfoData:{require:!0}},data:function(){return{previewVisible:!1,previewImage:"",fileList:[],planList:[],reviewList:[],loading:!1}},computed:l()({},Object(d.mapState)({user:function(t){return t.account.user}}),{columns:function(){return[{title:"物品名称",dataIndex:"name"},{title:"型号",dataIndex:"type"},{title:"数量",dataIndex:"amount"},{title:"单位",dataIndex:"unit"},{title:"备注",dataIndex:"remark"}]},current:function(){return-1===this.applicationInfoData.process?this.applicationInfoData.step:this.applicationInfoData.step+this.applicationInfoData.process},status:function(){return 2===this.applicationInfoData.process?"finish":-1===this.applicationInfoData.process?"error":"process"}}),methods:{handleCancleClick:function(){this.$emit("close")},processEnglishToChinese:function(t){switch(t){case 0:return"后勤";case 1:return"财务";case 2:return"副职";case 3:return"正职";default:return t}},bell:function(t){var e=this,a=this.user.username+" 催了您一下采购申请单号为 "+this.applicationInfoData.num+" 的流程进度";this.$post("message",{message:a,sender:this.user.username,senderDept:this.user.deptName,addressee:t}).then(function(a){e.$message.success("已向 "+("logistics"===t?"行政后勤":t)+" 通知")})},handleCancel:function(){this.previewVisible=!1},handlePreview:function(t){this.previewImage=t.url||t.thumbUrl,this.previewVisible=!0},handleChange:function(t){var e=t.file,a=t.fileList;t.event,"error"===e.status?this.$message.error(e.name+" 上传失败"):"removed"===e.status&&(this.fileList=a)},handleRemove:function(t){var e=this;"removed"===t.status&&e.$delete("application/deleteFile/"+t.uid).then(function(){e.$message.success(t.name+" 删除成功")})},handleNoPermissionRemove:function(t){t.status="done",this.$message.warning("您无此权限")},handleBeforeUpload:function(t){var e="image/jpeg"===t.type,a="image/png"===t.type;e||a||this.$message.error("You can only upload JPG or PNG file!");var i=t.size/1024/1024<2;return i||this.$message.error("Image must smaller than 2MB!"),(e||a)&&i},customRequest:function(t){var e=this,a=t.data,i=t.file,o=t.filename,r=t.onError,l=t.onProgress,c=t.onSuccess,p=new FormData;return a&&s()(a).map(function(t){p.append(t,a[t])}),p.append(o,i),p.append("id",this.applicationInfoData.id),this.$upload("application/uploadApplicationPhoto",p,{onUploadProgress:function(t){var e=t.total,a=t.loaded;l({percent:Math.round(a/e*100).toFixed(2)},i)}}).then(function(t){e.$message.success(i.name+" 上传成功"),e.fileList=[].concat(n()(e.fileList),[t.data.data]),c(t.data.data,i)}).catch(r),{abort:function(){this.$message.warning("upload progress is aborted.")}}}},watch:{applicationInfoVisiable:function(){var t=this;this.applicationInfoVisiable&&(this.reviewList=this.applicationInfoData.review.split(","),this.loading=!0,this.$get("application/applicationPlan",{applicationId:this.applicationInfoData.id}).then(function(e){t.loading=!1,t.planList=e.data}),this.$get("application/applicationFiles",{applicationId:this.applicationInfoData.id}).then(function(e){t.fileList=e.data.data}))}}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"采购申请信息",centered:!0,width:1e3,visible:t.applicationInfoVisiable,keyboard:!1,footer:null},on:{cancel:t.handleCancleClick}},[a("a-card",{attrs:{bordered:!1}},[a("a-steps",{attrs:{progressDot:"",current:t.current,status:t.status}},[a("a-step",{attrs:{title:"创建"}},[a("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:t.applicationInfoData.createDate}})],1)],1),t._v(" "),t._l(t.reviewList,function(e,i){return[a("a-step",{key:i,attrs:{title:t.processEnglishToChinese(i)}},[a("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[t.current===i+1&&0===t.applicationInfoData.process&&e!==t.user.username?a("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(a){return t.bell(e)}}}):t.current>i+1||1===t.applicationInfoData.process?a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核通过",icon:"check-circle"}}):t.current===i+1&&-1===t.applicationInfoData.process?a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核未通过",icon:"exclamation-circle"}}):t._e()],1)],1)]}),t._v(" "),a("a-step",{attrs:{title:"待入库"}},[a("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[1===t.applicationInfoData.process?a("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(e){return t.bell("logistics")}}}):2===t.applicationInfoData.process?a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"已入库",icon:"check-circle"}}):t._e()],1)],1),t._v(" "),a("a-step",{attrs:{title:"完成"}})],2),t._v(" "),a("a-divider",{staticStyle:{"margin-bottom":"32px"}})],1),t._v(" "),a("a-card",{attrs:{bordered:!1}},[a("detail-list",{attrs:{title:"申请单"}},[a("detail-list-item",{attrs:{term:"编号"}},[t._v(t._s(t.applicationInfoData.num))]),t._v(" "),a("detail-list-item",{attrs:{term:"物资类别"}},[t._v(t._s(t.applicationInfoData.typeApplicationToDict))]),t._v(" "),a("detail-list-item",{attrs:{term:"申请部门"}},[t._v(t._s(t.applicationInfoData.deptName))]),t._v(" "),a("detail-list-item",{attrs:{term:"经办人"}},[t._v(t._s(t.applicationInfoData.handle))]),t._v(" "),a("detail-list-item",{attrs:{term:"预计金额"}},[t._v(t._s(t.$tools.addZero(t.$tools.toNumFormant(t.applicationInfoData.money))))]),t._v(" "),a("detail-list-item",{attrs:{term:"采购说明"}},[t._v(t._s(t.applicationInfoData.description))])],1),t._v(" "),a("a-divider",{staticStyle:{"margin-bottom":"32px"}}),t._v(" "),a("detail-list",{attrs:{title:"计划单"}},[a("a-table",{ref:"TableInfo",attrs:{columns:t.columns,dataSource:t.planList,pagination:!1,loading:t.loading,rowKey:"id"}})],1),t._v(" "),a("div",{staticStyle:{"margin-top":"32px"}},[a("div",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"application:addDeletePhoto",expression:"'application:addDeletePhoto'"}]},[a("a-upload",{attrs:{accept:"image/jpg,image/png,image/jpeg,image/bmp",listType:"picture-card",fileList:t.fileList,remove:t.handleRemove,customRequest:t.customRequest,beforeUpload:t.handleBeforeUpload},on:{preview:t.handlePreview,change:t.handleChange}},[t.fileList.length<8?a("div",[a("a-icon",{attrs:{type:"plus"}}),t._v(" "),a("div",{staticClass:"ant-upload-text"},[t._v("Upload")])],1):t._e()]),t._v(" "),a("a-modal",{attrs:{visible:t.previewVisible,footer:null},on:{cancel:t.handleCancel}},[a("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:t.previewImage}})])],1),t._v(" "),a("div",{directives:[{name:"hasNoPermission",rawName:"v-hasNoPermission",value:"application:addDeletePhoto",expression:"'application:addDeletePhoto'"}]},[a("a-upload",{attrs:{accept:"image/jpg,image/png,image/jpeg,image/bmp",listType:"picture-card",fileList:t.fileList,remove:t.handleNoPermissionRemove,customRequest:t.customRequest,beforeUpload:t.handleBeforeUpload},on:{preview:t.handlePreview,change:t.handleChange}}),t._v(" "),a("a-modal",{attrs:{visible:t.previewVisible,footer:null},on:{cancel:t.handleCancel}},[a("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:t.previewImage}})])],1)])],1)],1)},staticRenderFns:[]},h=a("VU/8")(m,f,!1,function(t){a("kWdU")},"data-v-257d4227",null);e.default=h.exports},wTVK:function(t,e){}});