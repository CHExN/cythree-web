webpackJsonp([50],{aY7u:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("Gu7T"),s=i.n(a),n=i("fZjL"),o=i.n(n),r=i("Dd8w"),l=i.n(r),p=i("dC1H"),c=i("et8n"),u=i("SJI6"),d=p.a.Item,f={components:{AStepItemGroup:c.a.Group,AStepItem:c.a,DetailListItem:d,DetailList:p.a},name:"OfficeSuppliesInfo",props:{officeSuppliesInfoVisiable:{require:!0,default:!1},officeSuppliesInfoData:{require:!0}},data:function(){return{previewVisible:!1,previewImage:"",fileList:[],planList:[],reviewList:[],loading:!1}},computed:l()({},Object(u.mapState)({user:function(e){return e.account.user}}),{columns:function(){return[{title:"物品名称",dataIndex:"name"},{title:"型号",dataIndex:"type"},{title:"数量",dataIndex:"amount"},{title:"单位",dataIndex:"unit"},{title:"备注",dataIndex:"remark"}]},current:function(){return-1===this.officeSuppliesInfoData.process?this.officeSuppliesInfoData.step:this.officeSuppliesInfoData.step+this.officeSuppliesInfoData.process},status:function(){return 2===this.officeSuppliesInfoData.process?"finish":-1===this.officeSuppliesInfoData.process?"error":"process"}}),methods:{handleCancleClick:function(){this.$emit("close")},bell:function(e){var t=this,i=this.user.username+" 催了您一下办公用品申请单号为 "+this.officeSuppliesInfoData.num+" 的流程进度";this.$post("message",{message:i,sender:this.user.username,senderDept:this.user.deptName,addressee:e}).then(function(i){t.$message.success("已向 "+("logistics"===e?"行政后勤":e)+" 通知")})},handleCancel:function(){this.previewVisible=!1},handlePreview:function(e){this.previewImage=e.url||e.thumbUrl,this.previewVisible=!0},handleChange:function(e){var t=e.file,i=e.fileList;e.event,"error"===t.status?this.$message.error(t.name+" 上传失败"):"removed"===t.status&&(this.fileList=i)},handleRemove:function(e){var t=this;"removed"===e.status&&t.$delete("application/deleteFile/"+e.uid).then(function(){t.$message.success(e.name+" 删除成功")})},handleNoPermissionRemove:function(e){e.status="done",this.$message.warning("您无此权限")},handleBeforeUpload:function(e){var t="image/jpeg"===e.type,i="image/png"===e.type;t||i||this.$message.error("You can only upload JPG or PNG file!");var a=e.size/1024/1024<2;return a||this.$message.error("Image must smaller than 2MB!"),(t||i)&&a},customRequest:function(e){var t=this,i=e.data,a=e.file,n=e.filename,r=e.onError,l=e.onProgress,p=e.onSuccess,c=new FormData;return i&&o()(i).map(function(e){c.append(e,i[e])}),c.append(n,a),c.append("id",this.officeSuppliesInfoData.id),this.$upload("application/uploadApplicationPhoto",c,{onUploadProgress:function(e){var t=e.total,i=e.loaded;l({percent:Math.round(i/t*100).toFixed(2)},a)}}).then(function(e){t.$message.success(a.name+" 上传成功"),t.fileList=[].concat(s()(t.fileList),[e.data.data]),p(e.data.data,a)}).catch(r),{abort:function(){this.$message.warning("upload progress is aborted.")}}}},watch:{officeSuppliesInfoVisiable:function(){var e=this;this.officeSuppliesInfoVisiable&&(this.reviewList=this.officeSuppliesInfoData.review.split(","),this.loading=!0,this.$get("application/applicationPlan",{applicationId:this.officeSuppliesInfoData.id}).then(function(t){e.loading=!1,e.planList=t.data}),this.$get("application/applicationFiles",{applicationId:this.officeSuppliesInfoData.id}).then(function(t){e.fileList=t.data.data}))}}},m={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-modal",{attrs:{title:"办公用品申请信息",centered:!0,width:1e3,visible:e.officeSuppliesInfoVisiable,keyboard:!1,footer:null},on:{cancel:e.handleCancleClick}},[i("a-card",{attrs:{bordered:!1}},[i("a-steps",{attrs:{progressDot:"",current:e.current,status:e.status}},[i("a-step",{attrs:{title:"创建"}},[i("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[i("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:e.officeSuppliesInfoData.createDate}})],1)],1),e._v(" "),e._l(e.reviewList,function(t,a){return[i("a-step",{key:a,attrs:{title:"后勤"}},[i("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[e.current===a+1&&0===e.officeSuppliesInfoData.process&&t!==e.user.username?i("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(i){return e.bell(t)}}}):e.current>a+1||1===e.officeSuppliesInfoData.process?i("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核通过",icon:"check-circle"}}):e.current===a+1&&-1===e.officeSuppliesInfoData.process?i("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核未通过",icon:"exclamation-circle"}}):e._e()],1)],1)]}),e._v(" "),i("a-step",{attrs:{title:"待入库"}},[i("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[1===e.officeSuppliesInfoData.process?i("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(t){return e.bell("logistics")}}}):2===e.officeSuppliesInfoData.process?i("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"已入库",icon:"check-circle"}}):e._e()],1)],1),e._v(" "),i("a-step",{attrs:{title:"完成"}})],2),e._v(" "),i("a-divider",{staticStyle:{"margin-bottom":"32px"}})],1),e._v(" "),i("a-card",{attrs:{bordered:!1}},[i("detail-list",[i("a-table",{ref:"TableInfo",attrs:{columns:e.columns,dataSource:e.planList,pagination:!1,loading:e.loading,rowKey:"id"}})],1),e._v(" "),i("div",{staticStyle:{"margin-top":"32px"}},[i("div",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"application:addDeletePhoto",expression:"'application:addDeletePhoto'"}]},[i("a-upload",{attrs:{accept:"image/jpg,image/png,image/jpeg,image/bmp",listType:"picture-card",fileList:e.fileList,remove:e.handleRemove,customRequest:e.customRequest,beforeUpload:e.handleBeforeUpload},on:{preview:e.handlePreview,change:e.handleChange}},[e.fileList.length<8?i("div",[i("a-icon",{attrs:{type:"plus"}}),e._v(" "),i("div",{staticClass:"ant-upload-text"},[e._v("Upload")])],1):e._e()]),e._v(" "),i("a-modal",{attrs:{visible:e.previewVisible,footer:null},on:{cancel:e.handleCancel}},[i("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:e.previewImage}})])],1),e._v(" "),i("div",{directives:[{name:"hasNoPermission",rawName:"v-hasNoPermission",value:"application:addDeletePhoto",expression:"'application:addDeletePhoto'"}]},[i("a-upload",{attrs:{accept:"image/jpg,image/png,image/jpeg,image/bmp",listType:"picture-card",fileList:e.fileList,remove:e.handleNoPermissionRemove,customRequest:e.customRequest,beforeUpload:e.handleBeforeUpload},on:{preview:e.handlePreview,change:e.handleChange}}),e._v(" "),i("a-modal",{attrs:{visible:e.previewVisible,footer:null},on:{cancel:e.handleCancel}},[i("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:e.previewImage}})])],1)])],1)],1)},staticRenderFns:[]},h=i("VU/8")(f,m,!1,function(e){i("bpeE")},"data-v-c96efd4a",null);t.default=h.exports},bpeE:function(e,t){}});