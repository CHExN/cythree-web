webpackJsonp([85],{kWdU:function(t,e){},wFiq:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Gu7T"),s=a.n(i),n=a("fZjL"),o=a.n(n),r=a("Dd8w"),l=a.n(r),p=a("dC1H"),c=a("et8n"),d=a("SJI6"),u=p.a.Item,m={components:{AStepItemGroup:c.a.Group,AStepItem:c.a,DetailListItem:u,DetailList:p.a},name:"ApplicationInfo",props:{applicationInfoVisiable:{require:!0,default:!1},applicationInfoData:{require:!0}},data:function(){return{previewVisible:!1,previewImage:"",fileList:[],planList:[],reviewList:[],loading:!1}},computed:l()({},Object(d.mapState)({user:function(t){return t.account.user}}),{columns:function(){return[{title:"物品名称",dataIndex:"name"},{title:"型号",dataIndex:"type"},{title:"数量",dataIndex:"amount"},{title:"单位",dataIndex:"unit"},{title:"备注",dataIndex:"remark"}]},current:function(){return-1===this.applicationInfoData.process?this.applicationInfoData.step:this.applicationInfoData.step+this.applicationInfoData.process},status:function(){return 2===this.applicationInfoData.process?"finish":-1===this.applicationInfoData.process?"error":"process"}}),methods:{handleCancleClick:function(){this.$emit("close")},processEnglishToChinese:function(t){switch(t){case 0:return"后勤";case 1:return"财务";case 2:return"副职";case 3:return"正职";default:return t}},bell:function(t){var e=this,a=this.user.username+" 催了您一下采购申请单号为 "+this.applicationInfoData.num+" 的流程进度";this.$post("message",{message:a,sender:this.user.username,senderDept:this.user.deptName,addressee:t}).then(function(a){e.$message.success("已向 "+("logistics"===t?"行政后勤":t)+" 通知")})},handleCancel:function(){this.previewVisible=!1},handlePreview:function(t){this.previewImage=t.url||t.thumbUrl,this.previewVisible=!0},handleChange:function(t){var e=t.file,a=t.fileList;t.event,"error"===e.status?this.$message.error(e.name+" 上传失败"):"removed"===e.status&&(this.fileList=a)},handleRemove:function(t){var e=this;"removed"===t.status&&e.$delete("application/deleteFile/"+t.uid).then(function(){e.$message.success(t.name+" 删除成功")})},handleNoPermissionRemove:function(t){t.status="done",this.$message.warning("您无此权限")},handleBeforeUpload:function(t){var e="image/jpeg"===t.type,a="image/png"===t.type;e||a||this.$message.error("You can only upload JPG or PNG file!");var i=t.size/1024/1024<2;return i||this.$message.error("Image must smaller than 2MB!"),(e||a)&&i},customRequest:function(t){var e=this,a=t.data,i=t.file,n=t.filename,r=t.onError,l=t.onProgress,p=t.onSuccess,c=new FormData;return a&&o()(a).map(function(t){c.append(t,a[t])}),c.append(n,i),c.append("id",this.applicationInfoData.id),this.$upload("application/uploadApplicationPhoto",c,{onUploadProgress:function(t){var e=t.total,a=t.loaded;l({percent:Math.round(a/e*100).toFixed(2)},i)}}).then(function(t){e.$message.success(i.name+" 上传成功"),e.fileList=[].concat(s()(e.fileList),[t.data.data]),p(t.data.data,i)}).catch(r),{abort:function(){this.$message.warning("upload progress is aborted.")}}}},watch:{applicationInfoVisiable:function(){var t=this;this.applicationInfoVisiable&&(this.reviewList=this.applicationInfoData.review.split(","),this.loading=!0,this.$get("application/applicationPlan",{applicationId:this.applicationInfoData.id}).then(function(e){t.loading=!1,t.planList=e.data}),this.$get("application/applicationFiles",{applicationId:this.applicationInfoData.id}).then(function(e){t.fileList=e.data.data}))}}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"采购申请信息",centered:!0,width:1e3,visible:t.applicationInfoVisiable,keyboard:!1,footer:null},on:{cancel:t.handleCancleClick}},[a("a-card",{attrs:{bordered:!1}},[a("a-steps",{attrs:{progressDot:"",current:t.current,status:t.status}},[a("a-step",{attrs:{title:"创建"}},[a("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:t.applicationInfoData.createDate}})],1)],1),t._v(" "),t._l(t.reviewList,function(e,i){return[a("a-step",{key:i,attrs:{title:t.processEnglishToChinese(i)}},[a("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[t.current===i+1&&0===t.applicationInfoData.process&&e!==t.user.username?a("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(a){return t.bell(e)}}}):t.current>i+1||1===t.applicationInfoData.process?a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核通过",icon:"check-circle"}}):t.current===i+1&&-1===t.applicationInfoData.process?a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核未通过",icon:"exclamation-circle"}}):t._e()],1)],1)]}),t._v(" "),a("a-step",{attrs:{title:"待入库"}},[a("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[1===t.applicationInfoData.process?a("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(e){return t.bell("logistics")}}}):2===t.applicationInfoData.process?a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"已入库",icon:"check-circle"}}):t._e()],1)],1),t._v(" "),a("a-step",{attrs:{title:"完成"}})],2),t._v(" "),a("a-divider",{staticStyle:{"margin-bottom":"32px"}})],1),t._v(" "),a("a-card",{attrs:{bordered:!1}},[a("detail-list",{attrs:{title:"申请单"}},[a("detail-list-item",{attrs:{term:"编号"}},[t._v(t._s(t.applicationInfoData.num))]),t._v(" "),a("detail-list-item",{attrs:{term:"物资类别"}},[t._v(t._s(t.applicationInfoData.typeApplicationToDict))]),t._v(" "),a("detail-list-item",{attrs:{term:"申请部门"}},[t._v(t._s(t.applicationInfoData.deptName))]),t._v(" "),a("detail-list-item",{attrs:{term:"经办人"}},[t._v(t._s(t.applicationInfoData.handle))]),t._v(" "),a("detail-list-item",{attrs:{term:"预计金额"}},[t._v(t._s(t.$tools.addZero(t.$tools.toNumFormant(t.applicationInfoData.money))))]),t._v(" "),a("detail-list-item",{attrs:{term:"采购说明"}},[t._v(t._s(t.applicationInfoData.description))])],1),t._v(" "),a("a-divider",{staticStyle:{"margin-bottom":"32px"}}),t._v(" "),a("detail-list",{attrs:{title:"计划单"}},[a("a-table",{ref:"TableInfo",attrs:{columns:t.columns,dataSource:t.planList,pagination:!1,loading:t.loading,rowKey:"id"}})],1),t._v(" "),a("div",{staticStyle:{"margin-top":"32px"}},[a("div",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"application:addDeletePhoto",expression:"'application:addDeletePhoto'"}]},[a("a-upload",{attrs:{accept:"image/jpg,image/png,image/jpeg,image/bmp",listType:"picture-card",fileList:t.fileList,remove:t.handleRemove,customRequest:t.customRequest,beforeUpload:t.handleBeforeUpload},on:{preview:t.handlePreview,change:t.handleChange}},[t.fileList.length<8?a("div",[a("a-icon",{attrs:{type:"plus"}}),t._v(" "),a("div",{staticClass:"ant-upload-text"},[t._v("Upload")])],1):t._e()]),t._v(" "),a("a-modal",{attrs:{visible:t.previewVisible,footer:null},on:{cancel:t.handleCancel}},[a("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:t.previewImage}})])],1),t._v(" "),a("div",{directives:[{name:"hasNoPermission",rawName:"v-hasNoPermission",value:"application:addDeletePhoto",expression:"'application:addDeletePhoto'"}]},[a("a-upload",{attrs:{accept:"image/jpg,image/png,image/jpeg,image/bmp",listType:"picture-card",fileList:t.fileList,remove:t.handleNoPermissionRemove,customRequest:t.customRequest,beforeUpload:t.handleBeforeUpload},on:{preview:t.handlePreview,change:t.handleChange}}),t._v(" "),a("a-modal",{attrs:{visible:t.previewVisible,footer:null},on:{cancel:t.handleCancel}},[a("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:t.previewImage}})])],1)])],1)],1)},staticRenderFns:[]},h=a("VU/8")(m,f,!1,function(t){a("kWdU")},"data-v-257d4227",null);e.default=h.exports}});