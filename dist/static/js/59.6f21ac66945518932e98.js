webpackJsonp([59],{"DH+N":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("Gu7T"),r=s.n(a),i=s("fZjL"),n=s.n(i),l=s("Dd8w"),o=s.n(l),c=s("dC1H"),u=s("et8n"),d=s("SJI6"),f=c.a.Item,p={components:{AStepItemGroup:u.a.Group,AStepItem:u.a,DetailListItem:f,DetailList:c.a},name:"LetterInfo",props:{letterInfoVisiable:{require:!0,default:!1},letterInfoData:{require:!0}},data:function(){return{fileList:[],reviewList:[]}},computed:o()({},Object(d.mapState)({user:function(t){return t.account.user}}),{current:function(){return-1===this.letterInfoData.process?this.letterInfoData.step:this.letterInfoData.step+this.letterInfoData.process},status:function(){return 1===this.letterInfoData.process?"finish":-1===this.letterInfoData.process?"error":"process"}}),methods:{handleCancleClick:function(){this.$emit("close")},processEnglishToChinese:function(t){switch(t){case 0:return"副职";case 1:return"正职";default:return t}},handleRemove:function(t){var e=this;if("removed"===t.status){e.$delete("letter/deleteFile/"+t.uid).then(function(){e.$message.success(t.name.slice(t.name.indexOf("_")+1)+" 删除成功")});var s=e.fileList.indexOf(t),a=e.fileList.slice();a.splice(s,1),e.fileList=a}},handleBeforeUpload:function(t){var e=t.size/1024/1024<20;return e||this.$message.error("File must smaller than 20Mb!"),e},customRequest:function(t){var e=this,s=t.data,a=t.file,i=(t.filename,t.onError),l=t.onProgress,o=t.onSuccess,c=new FormData;return s&&n()(s).map(function(t){c.append(t,s[t])}),c.append("file",a),c.append("id",this.letterInfoData.letterId),this.$upload("letter/uploadLetterFile",c,{onUploadProgress:function(t){var e=t.total,s=t.loaded;l({percent:Math.round(s/e*100).toFixed(2)},a)}}).then(function(t){e.$message.success(a.name+" 上传成功"),e.fileList=[].concat(r()(e.fileList),[t.data.data]),o(t.data.data,a)}).catch(i),{abort:function(){this.$message.warning("upload progress is aborted.")}}},bell:function(t){var e=this,s=this.user.username+" 催了您一下介绍信人为 "+this.letterInfoData.letterUser+" 的流程进度";this.$post("message",{message:s,sender:this.user.username,senderDept:this.user.deptName,addressee:t}).then(function(s){e.$message.success("已向 "+t+" 通知")})}},watch:{letterInfoVisiable:function(){var t=this;this.letterInfoVisiable&&(this.reviewList=this.letterInfoData.review.split(","),this.$get("letter/letterFiles",{letterId:this.letterInfoData.letterId}).then(function(e){t.fileList=e.data.data}))}}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("a-modal",{attrs:{title:"介绍信信息",centered:!0,width:1e3,visible:t.letterInfoVisiable,keyboard:!1,footer:null},on:{cancel:t.handleCancleClick}},[s("a-card",{attrs:{bordered:!1}},[s("a-steps",{attrs:{progressDot:"",current:t.current,status:t.status}},[s("a-step",{attrs:{title:"创建"}},[s("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[s("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:t.letterInfoData.createDate}})],1)],1),t._v(" "),t._l(t.reviewList,function(e,a){return[s("a-step",{key:a,attrs:{title:t.processEnglishToChinese(a)}},[s("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[t.current===a+1&&0===t.letterInfoData.process&&e!==t.user.username?s("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(s){return t.bell(e)}}}):t.current>a+1||1===t.letterInfoData.process?s("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核通过",icon:"check-circle"}}):t.current===a+1&&-1===t.letterInfoData.process?s("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核未通过",icon:"exclamation-circle"}}):t._e()],1)],1)]}),t._v(" "),s("a-step",{attrs:{title:"完成"}})],2),t._v(" "),s("a-divider",{staticStyle:{"margin-bottom":"32px"}})],1),t._v(" "),s("a-card",{attrs:{bordered:!1}},[s("detail-list",{attrs:{title:"基本信息"}},[s("detail-list-item",{attrs:{term:"部门"}},[t._v(t._s(t.letterInfoData.deptName))]),t._v(" "),s("detail-list-item",{attrs:{term:"备注"}},[t._v(t._s(t.letterInfoData.remark))]),t._v(" "),s("detail-list-item",{attrs:{term:"介绍信人"}},[t._v(t._s(t.letterInfoData.letterUser))])],1),t._v(" "),s("div",{staticStyle:{"margin-top":"32px"}},[s("a-upload-dragger",{attrs:{fileList:t.fileList,remove:t.handleRemove,customRequest:t.customRequest,beforeUpload:t.handleBeforeUpload,disabled:t.fileList.length>5}},[s("p",{staticClass:"ant-upload-drag-icon"},[s("a-icon",{attrs:{type:"inbox"}})],1),t._v(" "),s("p",{staticClass:"ant-upload-hint"},[t._v("单击或拖动文件到此区域进行上传")])])],1)],1)],1)},staticRenderFns:[]},h=s("VU/8")(p,m,!1,function(t){s("rCdZ")},"data-v-71929a3d",null);e.default=h.exports},rCdZ:function(t,e){}});