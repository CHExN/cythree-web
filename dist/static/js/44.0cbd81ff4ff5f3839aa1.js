webpackJsonp([44],{eioI:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Gu7T"),i=s.n(a),n=s("fZjL"),r=s.n(n),o=s("Dd8w"),l=s.n(o),c=s("dC1H"),d=s("et8n"),p=s("SJI6"),u=c.a.Item,f={components:{AStepItemGroup:d.a.Group,AStepItem:d.a,DetailListItem:u,DetailList:c.a},name:"FixedAssetsInfo",props:{fixedAssetsInfoVisiable:{require:!0,default:!1},fixedAssetsInfoData:{require:!0}},data:function(){return{previewVisible:!1,previewImage:"",fileList:[],planList:[],reviewList:[],loading:!1}},computed:l()({},Object(p.mapState)({user:function(e){return e.account.user}}),{columns:function(){return[{title:"物品名称",dataIndex:"name"},{title:"数量",dataIndex:"amount"},{title:"金额",dataIndex:"remark"}]},current:function(){return-1===this.fixedAssetsInfoData.process?this.fixedAssetsInfoData.step:this.fixedAssetsInfoData.step+this.fixedAssetsInfoData.process},status:function(){return 2===this.fixedAssetsInfoData.process?"finish":-1===this.fixedAssetsInfoData.process?"error":"process"}}),methods:{handleCancleClick:function(){this.$emit("close")},processEnglishToChinese:function(e){switch(e){case 0:return"后勤";case 1:return"财务";case 2:return"副职";case 3:return"正职";default:return e}},bell:function(e){var t=this,s=this.user.username+" 催了您一下固定资产申请单号为 "+this.fixedAssetsInfoData.num+" 的流程进度";this.$post("message",{message:s,sender:this.user.username,senderDept:this.user.deptName,addressee:e}).then(function(s){t.$message.success("已向 "+("logistics"===e?"行政后勤":e)+" 通知")})},handleCancel:function(){this.previewVisible=!1},handlePreview:function(e){this.previewImage=e.url||e.thumbUrl,this.previewVisible=!0},handleChange:function(e){var t=e.file,s=e.fileList;e.event,"error"===t.status?this.$message.error(t.name+" 上传失败"):"removed"===t.status&&(this.fileList=s)},handleRemove:function(e){var t=this;"removed"===e.status&&t.$delete("application/deleteFile/"+e.uid).then(function(){t.$message.success(e.name+" 删除成功")})},handleNoPermissionRemove:function(e){e.status="done",this.$message.warning("您无此权限")},handleBeforeUpload:function(e){var t="image/jpeg"===e.type,s="image/png"===e.type;t||s||this.$message.error("You can only upload JPG or PNG file!");var a=e.size/1024/1024<2;return a||this.$message.error("Image must smaller than 2MB!"),(t||s)&&a},customRequest:function(e){var t=this,s=e.data,a=e.file,n=e.filename,o=e.onError,l=e.onProgress,c=e.onSuccess,d=new FormData;return s&&r()(s).map(function(e){d.append(e,s[e])}),d.append(n,a),d.append("id",this.fixedAssetsInfoData.id),this.$upload("application/uploadApplicationPhoto",d,{onUploadProgress:function(e){var t=e.total,s=e.loaded;l({percent:Math.round(s/t*100).toFixed(2)},a)}}).then(function(e){t.$message.success(a.name+" 上传成功"),t.fileList=[].concat(i()(t.fileList),[e.data.data]),c(e.data.data,a)}).catch(o),{abort:function(){this.$message.warning("upload progress is aborted.")}}}},watch:{fixedAssetsInfoVisiable:function(){var e=this;this.fixedAssetsInfoVisiable&&(this.reviewList=this.fixedAssetsInfoData.review.split(","),this.loading=!0,this.$get("application/applicationPlan",{applicationId:this.fixedAssetsInfoData.id}).then(function(t){e.loading=!1,e.planList=t.data}),this.$get("application/applicationFiles",{applicationId:this.fixedAssetsInfoData.id}).then(function(t){e.fileList=t.data.data}))}}},m={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a-modal",{attrs:{title:"固定资产申请信息",centered:!0,width:1e3,visible:e.fixedAssetsInfoVisiable,keyboard:!1,footer:null},on:{cancel:e.handleCancleClick}},[s("a-card",{attrs:{bordered:!1}},[s("a-steps",{attrs:{progressDot:"",current:e.current,status:e.status}},[s("a-step",{attrs:{title:"创建"}},[s("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[s("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:e.fixedAssetsInfoData.createDate}})],1)],1),e._v(" "),e._l(e.reviewList,function(t,a){return[s("a-step",{key:a,attrs:{title:e.processEnglishToChinese(a)}},[s("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[e.current===a+1&&0===e.fixedAssetsInfoData.process&&t!==e.user.username?s("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(s){return e.bell(t)}}}):e.current>a+1||1===e.fixedAssetsInfoData.process?s("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核通过",icon:"check-circle"}}):e.current===a+1&&-1===e.fixedAssetsInfoData.process?s("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核未通过",icon:"exclamation-circle"}}):e._e()],1)],1)]}),e._v(" "),s("a-step",{attrs:{title:"待入库"}},[s("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[1===e.fixedAssetsInfoData.process?s("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(t){return e.bell("logistics")}}}):2===e.fixedAssetsInfoData.process?s("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"已入库",icon:"check-circle"}}):e._e()],1)],1),e._v(" "),s("a-step",{attrs:{title:"完成"}})],2),e._v(" "),s("a-divider",{staticStyle:{"margin-bottom":"32px"}})],1),e._v(" "),s("a-card",{attrs:{bordered:!1}},[s("detail-list",[s("detail-list-item",{attrs:{term:"申请部门"}},[e._v(e._s(e.fixedAssetsInfoData.deptName))]),e._v(" "),s("detail-list-item",{attrs:{term:"申请日期"}},[e._v(e._s(e.fixedAssetsInfoData.createDate))]),e._v(" "),s("detail-list-item",{attrs:{term:"联系人"}},[e._v(e._s(e.fixedAssetsInfoData.handle))]),e._v(" "),s("detail-list-item",{attrs:{term:"电话"}},[e._v(e._s(e.fixedAssetsInfoData.num))]),e._v(" "),s("detail-list-item",{attrs:{term:"预计金额"}},[e._v(e._s(e.$tools.addZero(e.$tools.toNumFormant(e.fixedAssetsInfoData.money))))]),e._v(" "),s("detail-list-item",{attrs:{term:"申请购买理由"}},[e._v(e._s(e.fixedAssetsInfoData.description))])],1),e._v(" "),s("a-divider",{staticStyle:{"margin-bottom":"32px"}}),e._v(" "),s("detail-list",[s("a-table",{ref:"TableInfo",attrs:{columns:e.columns,dataSource:e.planList,pagination:!1,loading:e.loading,rowKey:"id"}})],1),e._v(" "),s("div",{staticStyle:{"margin-top":"32px"}},[s("div",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"application:addDeletePhoto",expression:"'application:addDeletePhoto'"}]},[s("a-upload",{attrs:{accept:"image/jpg,image/png,image/jpeg,image/bmp",listType:"picture-card",fileList:e.fileList,remove:e.handleRemove,customRequest:e.customRequest,beforeUpload:e.handleBeforeUpload},on:{preview:e.handlePreview,change:e.handleChange}},[e.fileList.length<8?s("div",[s("a-icon",{attrs:{type:"plus"}}),e._v(" "),s("div",{staticClass:"ant-upload-text"},[e._v("Upload")])],1):e._e()]),e._v(" "),s("a-modal",{attrs:{visible:e.previewVisible,footer:null},on:{cancel:e.handleCancel}},[s("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:e.previewImage}})])],1),e._v(" "),s("div",{directives:[{name:"hasNoPermission",rawName:"v-hasNoPermission",value:"application:addDeletePhoto",expression:"'application:addDeletePhoto'"}]},[s("a-upload",{attrs:{accept:"image/jpg,image/png,image/jpeg,image/bmp",listType:"picture-card",fileList:e.fileList,remove:e.handleNoPermissionRemove,customRequest:e.customRequest,beforeUpload:e.handleBeforeUpload},on:{preview:e.handlePreview,change:e.handleChange}}),e._v(" "),s("a-modal",{attrs:{visible:e.previewVisible,footer:null},on:{cancel:e.handleCancel}},[s("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:e.previewImage}})])],1)])],1)],1)},staticRenderFns:[]},h=s("VU/8")(f,m,!1,function(e){s("y6rO")},"data-v-f92db22a",null);t.default=h.exports},y6rO:function(e,t){}});