webpackJsonp([62],{C1xN:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Gu7T"),n=a.n(i),s=a("fZjL"),r=a.n(s),o=a("Dd8w"),c=a.n(o),l=a("dC1H"),d=a("et8n"),u=a("SJI6"),p=l.a.Item,f=[{name:"合同承办部门意见",value:"opinionStart",date:"dateStart"},{name:"法务审核意见",value:"opinionLegal",date:"dateLegal"},{name:"财务审核意见",value:"opinionFinancial",date:"dateFinancial"},{name:"关联部门意见",value:"opinionAss",date:"dateAss"},{name:"合同管理管理部门意见",value:"opinionOffice",date:"dateOffice"},{name:"合同承办部门主管领导意见",value:"opinionHead",date:"dateHead"},{name:"合同管理部门主管领导意见",value:"opinionViceCaptain",date:"dateViceCaptain"},{name:"单位负责人意见",value:"opinionCaptain",date:"dateCaptain"}],m={components:{AStepItemGroup:d.a.Group,AStepItem:d.a,DetailListItem:p,DetailList:l.a},name:"ContractInfo",props:{contractInfoVisiable:{require:!0,default:!1},contractInfoData:{require:!0}},data:function(){return{reviewNameList:["管理部门","承办部门领导","管理部门领导","单位负责人"],reviewList:[],fileList:[],data:f}},computed:c()({},Object(u.mapState)({user:function(t){return t.account.user}}),{current:function(){var t=this.contractInfoData,e=t.process,a=t.step,i=t.isInitiate,n=t.isFinance;return-1===e?0===i||0===n?1:a+1:0===i||0===n?1:a+e+1},status:function(){return 1===this.contractInfoData.process?"finish":-1===this.contractInfoData.process?"error":"process"}}),methods:{handleCancleClick:function(){this.$emit("close")},handleRemove:function(t){var e=this;if("removed"===t.status){e.$delete("contract/deleteFile/"+t.uid).then(function(){e.$message.success(t.name.slice(t.name.indexOf("_")+1)+" 删除成功")});var a=e.fileList.indexOf(t),i=e.fileList.slice();i.splice(a,1),e.fileList=i}},handleBeforeUpload:function(t){var e=t.size/1024/1024<20;return e||this.$message.error("File must smaller than 20Mb!"),e},customRequest:function(t){var e=this,a=t.data,i=t.file,s=(t.filename,t.onError),o=t.onProgress,c=t.onSuccess,l=new FormData;return a&&r()(a).map(function(t){l.append(t,a[t])}),l.append("file",i),l.append("id",this.contractInfoData.id),this.$upload("contract/uploadContractFile",l,{onUploadProgress:function(t){var e=t.total,a=t.loaded;o({percent:Math.round(a/e*100).toFixed(2)},i)}}).then(function(t){e.$message.success(i.name+" 上传成功"),e.fileList=[].concat(n()(e.fileList),[t.data.data]),c(t.data.data,i)}).catch(s),{abort:function(){this.$message.warning("upload progress is aborted.")}}},bell:function(t){var e=this,a=this.user.username+" 催了您一下合同联审单编号为 "+this.contractInfoData.contractNum+" 的审核进度";this.$post("message",{message:a,sender:this.user.username,senderDept:this.user.deptName,addressee:t}).then(function(a){e.$message.success("已向 "+t.replace(/,$/gi,"")+" 通知")})}},watch:{contractInfoVisiable:function(){var t=this;this.contractInfoVisiable&&(this.reviewList=this.contractInfoData.review.split(","),this.$get("contract/contractFiles",{contractId:this.contractInfoData.id}).then(function(e){t.fileList=e.data.data}))}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"合同联审单信息",centered:!0,width:1200,visible:t.contractInfoVisiable,keyboard:!1,footer:null},on:{cancel:t.handleCancleClick}},[a("a-card",{attrs:{bordered:!1}},[a("a-steps",{attrs:{progressDot:"",current:t.current,status:t.status}},[a("a-step",{attrs:{title:"创建"}},[a("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:t.contractInfoData.createDate}})],1)],1),t._v(" "),a("a-step",{attrs:{title:"联审部门"}},[a("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[1===t.current&&0===t.contractInfoData.process?a("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(e){t.bell((0===t.contractInfoData.isInitiate?t.user.username+",":"")+(0===t.contractInfoData.isFinance?"finance":""))}}}):1===t.contractInfoData.isInitiate&&1===t.contractInfoData.isFinance?a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核通过",icon:"check-circle"}}):a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核未通过",icon:"exclamation-circle"}})],1)],1),t._v(" "),t._l(t.reviewList,function(e,i){return[a("a-step",{key:i,attrs:{title:t.reviewNameList[i]}},[a("a-step-item-group",{attrs:{slot:"description"},slot:"description"},[t.current===i+2&&0===t.contractInfoData.process&&e!==t.user.username?a("a-step-item",{attrs:{title:"催一下",icon:"bell"},nativeOn:{click:function(a){return t.bell(e)}}}):t.current>i+2||1===t.contractInfoData.process?a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核通过",icon:"check-circle"}}):t.current===i+2&&-1===t.contractInfoData.process?a("a-step-item",{staticStyle:{cursor:"default"},attrs:{title:"审核未通过",icon:"exclamation-circle"}}):t._e()],1)],1)]}),t._v(" "),a("a-step",{attrs:{title:"完成"}})],2),t._v(" "),a("a-divider",{staticStyle:{"margin-bottom":"32px"}})],1),t._v(" "),a("a-card",{attrs:{bordered:!1}},[a("detail-list",{attrs:{title:"基本信息"}},[a("detail-list-item",{attrs:{term:"单位名称"}},[t._v("北京市朝阳区环境卫生服务中心")]),t._v(" "),a("detail-list-item",{attrs:{term:"承办部门"}},[t._v(t._s(t.contractInfoData.deptName))]),t._v(" "),a("detail-list-item",{attrs:{term:"合同名称"}},[t._v(t._s(t.contractInfoData.contractName))]),t._v(" "),a("detail-list-item",{attrs:{term:"合同对方"}},[t._v(t._s(t.contractInfoData.contractPartner))]),t._v(" "),a("detail-list-item",{attrs:{term:"合同约定事项是否经过招标"}},[t._v(t._s("1"===t.contractInfoData.isTender?"是":"否"))]),t._v(" "),a("detail-list-item",{attrs:{term:"合同编号"}},[t._v(t._s(t.contractInfoData.contractNum))]),t._v(" "),a("detail-list-item",{attrs:{term:"合同金额"}},[t._v(t._s(t.$tools.addZero(t.$tools.toNumFormant(t.contractInfoData.contractAmount)))+" 元")]),t._v(" "),a("detail-list-item",{attrs:{term:"其他情况说明"}},[t._v(t._s(t.contractInfoData.remark))])],1),t._v(" "),a("a-divider",{staticStyle:{"margin-bottom":"32px"}}),t._v(" "),a("detail-list",{attrs:{title:"审核情况"}},t._l(t.data,function(e,i){return a("a-card-grid",{key:i,staticStyle:{width:"25%",height:"100px",textAlign:"'center'"}},[a("a-comment",{staticStyle:{left:"-18px",top:"-22px"},attrs:{author:e.name}},[a("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.contractInfoData[e.value]?t.contractInfoData[e.value]:"- -"))]),t._v(" "),a("a-tooltip",{attrs:{slot:"datetime"},slot:"datetime"},[a("span",[t._v(t._s(t.contractInfoData[e.date]))])])],1)],1)}),1),t._v(" "),a("div",{staticStyle:{"margin-top":"32px"}},[a("a-upload-dragger",{attrs:{fileList:t.fileList,remove:t.handleRemove,customRequest:t.customRequest,beforeUpload:t.handleBeforeUpload,disabled:t.fileList.length>5}},[a("p",{staticClass:"ant-upload-drag-icon"},[a("a-icon",{attrs:{type:"inbox"}})],1),t._v(" "),a("p",{staticClass:"ant-upload-hint"},[t._v("单击或拖动文件到此区域进行上传")])])],1)],1)],1)},staticRenderFns:[]},h=a("VU/8")(m,v,!1,function(t){a("hNfg")},"data-v-6cb5e166",null);e.default=h.exports},hNfg:function(t,e){}});